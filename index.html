<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>圖片評估系統</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .image-item {
            background-color: #f9fafb;
            padding: 1.5rem;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 1.5rem;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .image-frame {
            width: 100%;
            aspect-ratio: 4 / 3;
            overflow: hidden;
            margin-bottom: 1rem;
            border: 1px solid #e5e7eb;
            border-radius: 0.375rem;
            position: relative;
            background-color: #e5e7eb;
            cursor: grab;
        }
        .gallery-image-in-frame {
            display: block;
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
            transform-origin: center center;
            transform: scale(1);
            will-change: transform;
        }
        .image-slider {
            width: 80%;
            margin-top: 0.5rem;
        }
        .response-area {
            width: 100%;
            margin-top: 1rem;
        }
        #login-section {
            padding: 2rem 0;
            background-color: #f3f4f6;
        }
        #logout-button {
            display: none;
            margin-left: 1rem;
            padding: 0.5rem 1rem;
            background-color: #ef4444;
            color: white;
            border-radius: 0.375rem;
            font-size: 0.875rem;
            cursor: pointer;
        }
        #logout-button:hover {
            background-color: #dc2626;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <nav class="bg-white shadow-md sticky top-0 z-50">
        <div class="container mx-auto px-6 py-3 flex justify-between items-center">
            <a href="#" class="font-bold text-xl text-indigo-600">圖片評估系統</a>
            <div class="flex items-center">
                <span id="login-status" class="text-sm text-gray-600">尚未登入</span>
                <button id="logout-button">登出</button>
            </div>
            <div class="hidden md:flex space-x-4">
                <a href="#features" class="text-gray-600 hover:text-indigo-600 px-3 py-2 rounded-md">說明</a>
                <a href="#gallery" class="text-gray-600 hover:text-indigo-600 px-3 py-2 rounded-md">評估區</a>
                <a href="#contact" class="text-gray-600 hover:text-indigo-600 px-3 py-2 rounded-md">聯絡</a>
            </div>
            <div class="md:hidden">
                <button id="mobile-menu-button" class="text-gray-600 hover:text-indigo-600 focus:outline-none">
                    <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
                </button>
            </div>
        </div>
        <div id="mobile-menu" class="md:hidden hidden px-2 pt-2 pb-3 space-y-1 sm:px-3">
            <a href="#features" class="block text-gray-600 hover:text-indigo-600 px-3 py-2 rounded-md">說明</a>
            <a href="#gallery" class="block text-gray-600 hover:text-indigo-600 px-3 py-2 rounded-md">評估區</a>
            <a href="#contact" class="block text-gray-600 hover:text-indigo-600 px-3 py-2 rounded-md">聯絡</a>
        </div>
    </nav>

    <section id="login-section">
        <div class="container mx-auto px-6 text-center">
            <h2 class="text-2xl font-bold mb-4">使用者登入</h2>
            <div id="login-form" class="max-w-sm mx-auto">
                <label for="account-id" class="block text-gray-700 text-sm font-bold mb-2">請輸入您的測試帳號:</label>
                <input type="text" id="account-id" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline mb-4" placeholder="例如：testuser01">
                <button id="login-button" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">
                    登入
                </button>
            </div>
            <p id="login-message" class="mt-4 text-red-500 text-sm"></p>
        </div>
    </section>

    <section id="features" class="py-16 bg-white">
        <div class="container mx-auto px-6">
            <h2 class="text-3xl font-bold text-center mb-12">功能說明</h2>
            <div class="max-w-3xl mx-auto text-center text-gray-700 space-y-4">
                <p>1. 在上方區塊輸入您的測試帳號進行登入。</p>
                <p>2. 登入後，下方的「圖片評估區」將會顯示。</p>
                <p>3. 對於每張圖片，您可以使用滑桿調整圖片在固定框內的縮放比例。</p>
                <p>4. 如果圖片放大，您可以按住滑鼠拖曳圖片以查看不同區域。</p>
                <p>5. 在下方的文字框輸入您對該圖片主體佔比或其他方面的評估。</p>
                <p>6. 點擊「提交回應」按鈕。系統將收集您的帳號、圖片 ID、縮放比例、位移量和文字回應，並在瀏覽器控制台 (Console) 中顯示這些資料。</p>
            </div>
        </div>
    </section>

    <section id="gallery" class="py-16 bg-gray-100 hidden">
        <div class="container mx-auto px-6">
            <h2 class="text-3xl font-bold text-center mb-12">圖片評估區</h2>
            <p class="text-center text-gray-600 mb-8">目前登入帳號: <span id="current-user" class="font-semibold"></span></p>

            <div id="image-gallery-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                <!-- 8 張圖片 -->
                ${Array.from({ length: 8 }, (_, i) => `
                <div class="image-item" data-image-id="img00${i + 1}">
                    <div class="image-frame">
                        <img src="https://placehold.co/600x450/${i % 2 === 0 ? 'dddddd' : '888888'}/ffffff?text=圖片+${i + 1}" alt="範例圖片 ${i + 1}" class="gallery-image-in-frame" data-translate-x="0" data-translate-y="0">
                    </div>
                    <div class="w-full text-center mt-2">
                        <label for="slider-${i + 1}" class="text-sm text-gray-600">縮放圖片: <span class="scale-value font-semibold">100%</span></label>
                        <input type="range" id="slider-${i + 1}" min="1" max="3" step="0.1" value="1" class="image-slider h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer dark:bg-gray-700">
                        <div class="flex justify-between text-xs text-gray-500 w-[80%] mx-auto">
                            <span>原始</span>
                            <span>放大</span>
                        </div>
                    </div>
                    <div class="response-area">
                        <label for="response-${i + 1}" class="block text-gray-700 text-sm font-bold mb-2">回應圖片 ${i + 1}:</label>
                        <textarea id="response-${i + 1}" rows="3" class="shadow appearance-none border rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" placeholder="輸入您對圖片 ${i + 1} 的看法..."></textarea>
                        <button class="mt-2 w-full bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-2 px-4 rounded-lg focus:outline-none focus:shadow-outline transition duration-300 text-sm response-submit-button">
                            提交回應 ${i + 1}
                        </button>
                    </div>
                </div>`).join('')}
            </div>
        </div>
    </section>

    <footer class="bg-gray-800 text-white py-8">
        <div class="container mx-auto px-6 text-center">
            <p>&copy; 2025 圖片評估系統. 保留所有權利.</p>
        </div>
    </footer>

    <script>
        // --- DOM 元素 ---
        const mobileMenuButton = document.getElementById('mobile-menu-button');
        const mobileMenu = document.getElementById('mobile-menu');
        const loginForm = document.getElementById('login-form');
        const accountIdInput = document.getElementById('account-id');
        const loginButton = document.getElementById('login-button');
        const loginMessage = document.getElementById('login-message');
        const loginStatus = document.getElementById('login-status');
        const logoutButton = document.getElementById('logout-button');
        const gallerySection = document.getElementById('gallery');
        const currentUserDisplay = document.getElementById('current-user');
        const imageItems = document.querySelectorAll('.image-item');

        let loggedInUser = null;

        function showElement(el) {
            el.classList.remove('hidden');
        }
        function hideElement(el) {
            el.classList.add('hidden');
        }

        function login() {
            const accountId = accountIdInput.value.trim();
            if (!accountId) {
                loginMessage.textContent = '請輸入測試帳號！';
                return;
            }
            loggedInUser = accountId;
            loginMessage.textContent = '';
            hideElement(loginForm);
            loginStatus.textContent = `已登入: ${loggedInUser}`;
            currentUserDisplay.textContent = loggedInUser;
            showElement(gallerySection);
            showElement(logoutButton);
            gallerySection.scrollIntoView({ behavior: 'smooth' });
        }

        function logout() {
            loggedInUser = null;
            showElement(loginForm);
            accountIdInput.value = '';
            loginStatus.textContent = '尚未登入';
            hideElement(gallerySection);
            hideElement(logoutButton);
        }

        function initializeImageInteraction(item) {
            const slider = item.querySelector('.image-slider');
            const image = item.querySelector('.gallery-image-in-frame');
            const scaleValueDisplay = item.querySelector('.scale-value');
            const imageFrame = item.querySelector('.image-frame');

            let currentScale = 1;
            let translateX = 0;
            let translateY = 0;

            function updateTransform() {
                image.style.transform = `scale(${currentScale}) translate(${translateX}px, ${translateY}px)`;
            }

            slider.addEventListener('input', (event) => {
                currentScale = parseFloat(event.target.value);
                scaleValueDisplay.textContent = `${Math.round(currentScale * 100)}%`;
                translateX = 0;
                translateY = 0;
                updateTransform();
            });

            let isDragging = false;
            let startX, startY, initialTranslateX, initialTranslateY;

            imageFrame.addEventListener('mousedown', (e) => {
                if (currentScale > 1) {
                    isDragging = true;
                    startX = e.clientX;
                    startY = e.clientY;
                    initialTranslateX = translateX;
                    initialTranslateY = translateY;
                    imageFrame.style.cursor = 'grabbing';
                    image.style.transition = 'none';
                }
            });

            imageFrame.addEventListener('mousemove', (e) => {
                if (!isDragging) return;
                const dx = e.clientX - startX;
                const dy = e.clientY - startY;
                translateX = initialTranslateX + dx;
                translateY = initialTranslateY + dy;

                const frameWidth = imageFrame.offsetWidth;
                const frameHeight = imageFrame.offsetHeight;
                const imgWidth = image.offsetWidth * currentScale;
                const imgHeight = image.offsetHeight * currentScale;

                const maxTranslateX = Math.max(0, (imgWidth - frameWidth) / 2);
                const maxTranslateY = Math.max(0, (imgHeight - frameHeight) / 2);

                translateX = Math.max(-maxTranslateX, Math.min(maxTranslateX, translateX));
                translateY = Math.max(-maxTranslateY, Math.min(maxTranslateY, translateY));

                updateTransform();
            });

            const stopDragging = () => {
                if (isDragging) {
                    isDragging = false;
                    imageFrame.style.cursor = 'grab';
                    image.style.transition = 'transform 0.3s ease';
                }
            };

            imageFrame.addEventListener('mouseup', stopDragging);
            imageFrame.addEventListener('mouseleave', stopDragging);
        }

        function handleSubmitResponse(item) {
            const responseTextArea = item.querySelector('textarea');
            const submitButton = item.querySelector('.response-submit-button');
            const imageId = item.dataset.imageId;
            const image = item.querySelector('.gallery-image-in-frame');
            const slider = item.querySelector('.image-slider');

            submitButton.addEventListener('click', () => {
                if (!loggedInUser) {
                    alert('請先登入！');
                    return;
                }

                const responseText = responseTextArea.value.trim();
                if (!responseText) {
                    alert('請先輸入回應內容！');
                    return;
                }

                const finalScale = parseFloat(slider.value);
                const finalTranslateX = parseFloat(image.dataset.translateX) || 0;
                const finalTranslateY = parseFloat(image.dataset.translateY) || 0;

                const submissionData = {
                    userAccount: loggedInUser,
                    imageId: imageId,
                    timestamp: new Date().toISOString(),
                    finalScale: finalScale,
                    finalTranslateX: finalTranslateX,
                    finalTranslateY: finalTranslateY,
                    responseText: responseText
                };

                console.log("--- 模擬資料回傳 ---");
                console.log(submissionData);
                console.log("---------------------");

                alert(`已記錄對圖片 ${imageId} 的回應！(資料已顯示在瀏覽器 Console)`);
                responseTextArea.value = '';
            });
        }

        mobileMenuButton.addEventListener('click', () => {
            mobileMenu.classList.toggle('hidden');
        });

        loginButton.addEventListener('click', login);
        accountIdInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                login();
            }
        });

        logoutButton.addEventListener('click', logout);

        imageItems.forEach(item => {
            initializeImageInteraction(item);
            handleSubmitResponse(item);
        });
    </script>

</body>
</html>
